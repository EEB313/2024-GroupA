---
title: "EEB313 Project"
output: html_document
date: "2024-11-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## 
```{r}
salamanders <- read.csv("redback_salamander_abundance.csv")
unique(salamanders$Species)
unique(salamanders$Sample.Year)
salamanders
unique(salamanders$Year)
```

```{r}
present_salamanders <- salamanders %>%
  slice(-c(1)) %>%
  filter(!Eastern.Redback.Salamander.Count %in% "0") %>%
  filter(!Redback.form.of.Eastern.Redback.Salamander.Count %in% "N/A") %>%
  filter(!Leadback.form.of.Eastern.Redback.Salamander.Count %in% "N/A") 

present_salamanders
```
```{r}
#redback abundance by year 

redback_abundance <- present_salamanders %>%
  group_by(Year, Redback.form.of.Eastern.Redback.Salamander.Count) %>%
  tally()
redback_abundance


redback_abundance <- redback_abundance %>%
  mutate(across(c(Redback.form.of.Eastern.Redback.Salamander.Count, n), as.numeric)) %>%
  mutate(redback.abundance = Redback.form.of.Eastern.Redback.Salamander.Count * n)


byyear_redback <- redback_abundance %>%
  group_by(Year) %>%
  summarize(year_redback_abun = sum(redback.abundance))

byyear_redback

#leadback abundance by year 
leadback_abundance <- present_salamanders %>%
  group_by(Year, Leadback.form.of.Eastern.Redback.Salamander.Count) %>%
  tally()
leadback_abundance


leadback_abundance <- leadback_abundance %>%
  mutate(across(c(Leadback.form.of.Eastern.Redback.Salamander.Count, n), as.numeric)) %>%
  mutate(leadback.abundance = Leadback.form.of.Eastern.Redback.Salamander.Count * n)


byyear_leadback <- leadback_abundance %>%
  group_by(Year) %>%
  summarize(year_leadback_abun = sum(leadback.abundance))

byyear_leadback
```




```{r}
redback_abundance <- present_salamanders %>%
  # First convert the salamander count to numeric if it isn't already
 mutate(Redback.form.of.Eastern.Redback.Salamander.Count = as.numeric(Redback.form.of.Eastern.Redback.Salamander.Count)) %>%
  group_by(Year) %>% # Only group by Year
  summarise(
    n = n(),
    Redback.form.of.Eastern.Redback.Salamander.Count = sum(Redback.form.of.Eastern.Redback.Salamander.Count, na.rm = TRUE)
  )

# Now try the mutation
redback_abundance %>%  
  mutate(redback_abundance = Redback.form.of.Eastern.Redback.Salamander.Count * n)


```
```{r}
#Combine the red back and lead back abundances by year 
byyear_both <- cbind(byyear_redback, byyear_leadback) 
byyear_both <- byyear_both[,-3]
byyear_both

```

```{r}
#Calculate the annual growth rate 
# years <- c(2007:2019)
# 
# Redback_GrowthRate <- numeric(length(years))
# Leadback_GrowthRate <- numeric(length(years))
# year_redback_abun <- byyear_both$year_redback_abun
# year_leadback_abun <- byyear_both$year_leadback_abun
# 
# for (i in 2:length(years)){
#  Redback_GrowthRate <- year_redback_abun[i]/year_redback_abun[i-1]
#  Leadback_GrowthRate <-  year_leadback_abun[i]/year_leadback_abun[i-1]
# }

#Calculate the annual growth rate 
## Annual geometric population growth rates
# redback annual growth rate
N_redback <- byyear_both$year_redback_abun
lambda_red <- c()
# Vector of population abundances lambda <- c() # Empty vector to store lambda values
for (i in 1:length(N_redback)-1) { 
  lambda_red[i] <- ((N_redback[i + 1])/N_redback[i])
} 
lambda_red <- data.frame(lambda_red)
lambda_red

# lead back annual growth rates 
N_leadback <- byyear_both$year_leadback_abun
lambda_lead <- c()
# Vector of population abundances lambda <- c() # Empty vector to store lambda values
for (i in 1:length(N_leadback)-1) { 
  lambda_lead[i] <- ((N_leadback[i + 1])/N_leadback[i])
} 
lambda_lead <- data.frame(lambda_lead)
lambda_lead

lambda_red <- data.frame(lambda_red = c(NA, lambda_red$lambda_red))
lambda_lead <- data.frame(lambda_lead = c(NA, lambda_lead$lambda_lead))

# Now combine with byyear_both
salamanders_growth_rates <- data.frame(byyear_both, 
                                     lambda_lead = lambda_lead,
                                     lambda_red = lambda_red)
#Calculating average temperature by year 


temp_by_year <- present_salamanders %>%
  mutate(Air.Temperature..degC. = as.numeric(Air.Temperature..degC.)) %>%
  group_by(Year) %>%
  summarize(avg_temp = mean(Air.Temperature..degC., na.rm = TRUE))

# Join with byyear_both
byyear_both_temps <- salamanders_growth_rates %>%
  left_join(temp_by_year, by = "Year")

byyear_both_temps


```

```{r}
#Plot the growth rates as a function of temperature 
byyear_both_temps %>%
  ggplot(aes(x = avg_temp, y = lambda_red)) +
  geom_point() +
  geom_smooth(method = "nls", 
              formula = y ~ a * x^b,
              method.args = list(start = list(a = 1, b = 1)))

byyear_both_temps %>%
  ggplot(aes(x = avg_temp, y = lambda_lead)) +
  geom_point() +
  geom_smooth(method = "nls", 
              formula = y ~ a * x^b,
              method.args = list(start = list(a = 1, b = 1)))
#try precipitation 
```



