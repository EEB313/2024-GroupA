---
title: "EEB313 Project"
output: html_document
date: "2024-11-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## 
```{r}
salamanders <- read.csv("salamander.csv")
unique(salamanders$Species)
unique(salamanders$Sample.Year)
salamanders
unique(salamanders$Year)
```

```{r}
present_salamanders <- salamanders %>%
  slice(-c(1)) %>%
  filter(!Eastern.Redback.Salamander.Count %in% "0") %>%
  filter(!Redback.form.of.Eastern.Redback.Salamander.Count %in% "N/A") %>%
  filter(!Leadback.form.of.Eastern.Redback.Salamander.Count %in% "N/A") 

present_salamanders
```
```{r}
#redback abundance by year 

redback_abundance <- present_salamanders %>%
  group_by(Year, Redback.form.of.Eastern.Redback.Salamander.Count) %>%
  tally()
redback_abundance


redback_abundance <- redback_abundance %>%
  mutate(across(c(Redback.form.of.Eastern.Redback.Salamander.Count, n), as.numeric)) %>%
  mutate(redback.abundance = Redback.form.of.Eastern.Redback.Salamander.Count * n)


byyear_redback <- redback_abundance %>%
  group_by(Year) %>%
  summarize(year_redback_abun = sum(redback.abundance))

byyear_redback

#leadback abundance by year 
leadback_abundance <- present_salamanders %>%
  group_by(Year, Leadback.form.of.Eastern.Redback.Salamander.Count) %>%
  tally()
leadback_abundance


leadback_abundance <- leadback_abundance %>%
  mutate(across(c(Leadback.form.of.Eastern.Redback.Salamander.Count, n), as.numeric)) %>%
  mutate(leadback.abundance = Leadback.form.of.Eastern.Redback.Salamander.Count * n)


byyear_leadback <- leadback_abundance %>%
  group_by(Year) %>%
  summarize(year_leadback_abun = sum(leadback.abundance))

byyear_leadback


#ANOTHER EASIER WAY TO DO IT: pivot_longer -- have morph on one column and count data in other, group by morph, summarizing by taking the sum for eah year


```

```{r}
#Combine the red back and lead back abundances by year 
byyear_both <- cbind(byyear_redback, byyear_leadback) 
byyear_both <- byyear_both[,-3]
byyear_both

```

```{r}
#Calculate the annual growth rate 
byyear_both <- byyear_both %>%
  mutate(
    Redback_GrowthRate = (year_redback_abun - lag(year_redback_abun)) / lag(year_redback_abun),
    Leadback_GrowthRate = (year_leadback_abun - lag(year_leadback_abun)) / lag(year_leadback_abun)
  )

byyear_both

#Calculating average temperature by year 

temp_by_year <- present_salamanders %>%
  mutate(Air.Temperature..degC. = as.numeric(Air.Temperature..degC.)) %>%
  group_by(Year) %>%
  summarize(avg_temp = mean(Air.Temperature..degC., na.rm = TRUE))

# Join with byyear_both
byyear_both <- byyear_both %>%
  left_join(temp_by_year, by = "Year")

byyear_both

#WHY IS 2017 NA FOR LEADBACK? CHECK
```


```{r}
library(ggplot2)
library(dplyr)


# Update the column name
byyear_both <- byyear_both %>%
  mutate(avg_temp = as.numeric(avg_temp))

# Fit non-linear models for Redback and Leadback growth rates
redback_model <- nls(Redback_GrowthRate ~ a * exp(-((avg_temp - b)^2) / (2 * c^2)),
                     data = byyear_both,
                     start = list(a = 1, b = mean(byyear_both$avg_temp), c = 1))

leadback_model <- nls(Leadback_GrowthRate ~ a * exp(-((avg_temp - b)^2) / (2 * c^2)),
                      data = byyear_both,
                      start = list(a = 1, b = mean(byyear_both$avg_temp), c = 1))

# Predict values for plotting
temperature_seq <- seq(min(byyear_both$avg_temp), max(byyear_both$avg_temp), length.out = 100)
redback_pred <- predict(redback_model, newdata = data.frame(avg_temp = temperature_seq))
leadback_pred <- predict(leadback_model, newdata = data.frame(avg_temp = temperature_seq))

# Combine predictions into a dataframe
plot_data <- data.frame(
  avg_temp = temperature_seq,
  Redback_GrowthRate = redback_pred,
  Leadback_GrowthRate = leadback_pred
)

# Plot the thermal response curves
ggplot() +
  geom_point(data = byyear_both, aes(x = avg_temp, y = Redback_GrowthRate, color = "Redback"), size = 2) +
  geom_point(data = byyear_both, aes(x = avg_temp, y = Leadback_GrowthRate, color = "Leadback"), size = 2) +
  geom_line(data = plot_data, aes(x = avg_temp, y = Redback_GrowthRate, color = "Redback"), size = 1) +
  geom_line(data = plot_data, aes(x = avg_temp, y = Leadback_GrowthRate, color = "Leadback"), size = 1) +
  labs(title = "Thermal Response Curves for Salamander Morphs",
       x = "Average Temperature (Â°C)", y = "Growth Rate",
       color = "Morph") +
  theme_minimal()

```

MAYBE TEMPERATURE DOESNT ACTUALLY PREDIT ANYTHING? Lets try precipitation!
